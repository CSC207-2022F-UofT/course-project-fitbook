<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title th:text="${profile.getName()}">Profile</title>
    <style>
        nav {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 3rem;
            background-color: #fff8eb;
            color: orange;
            border-bottom: 3px solid #ffb34a;
            position: sticky;
            top: 0;
        }
        nav a {
            display: flex;
            align-items: center;
            height: 100%;
            padding: 0 10px;
            text-decoration: none;
            color: orange;
            transition: background-color 0.5s ease, color 0.5s ease;
        }
        nav h1 {
            height: 100%;
            margin: 0;
        }
        nav div {
            display: flex;
            align-items: center;
            height: 100%;
            margin: 0;
        }

        form {
            height: 60%;
        }

        input {
            border: 2px solid #ffb34a;
            height: 100%;
        }

        nav a:hover {
            background-color: #ffb34a;
            color: #fff8eb;
        }
        body {
            box-sizing: content-box;
            margin: 0;
            min-height: 100vh;
            width: 100%;
            background-color: #fff8eb;

        }
        .profile-card {
            font-family: "Helvetica Neue",serif;
            margin: 0 auto;
            width: 50%;
            height: 60%;
            display: flex;
            flex-direction: column;
        }
        .header {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .post-header {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .post-header div {
            display: flex;
            align-items: center;
        }
        .button {
            width: fit-content;
            padding: 10px;
            color: white;
            background-color: #ffb34a;
            border-radius: 8%;
            border: none;
            cursor: pointer;
            text-decoration: none;
        }

        .post-card {
            width: 80%;
            box-shadow: 0 .1rem 1rem rgba(0, 0, 0, 0.1);
            border: 4px solid #ffb34a;
            border-radius: 1em;
            margin: 0 auto 1em;
            display: flex;
            flex-direction: column;
            background: #fff8eb;
            padding: 4%;
        }

        .post-card a {
            text-decoration: none;
            color: black;
        }

        .body-part {
            border: 2px solid orange;
            margin: 0 2px;
            background: white;
            color: orange;
            padding: 4px;
            border-radius: 20%;
        }

        .exercises {
            width: 100%;
            border-bottom: 2px solid #ffb34a;
        }

        .exercise {
            width: 100%;
            padding: 4% 0 ;
        }

        .post-body {
            width: 100%;
            padding: 4% 0;
        }

    </style>
</head>
<body>
    <nav>
        <h1><a href="/">FitBook</a></h1>
            <form method="get" action="/search">
                <label>
                    <input type="text" name="queryString" placeholder="Search..">
                </label>
                <button type="submit" class="button">Submit</button>
            </form>
            <a href="/post">Create Post</a>
    </nav>
    <div class="profile-card">
        <div class="header">
            <h1 th:text="${profile.getName()}">Username</h1>
            <button th:attr="onclick=|followUser(this, '${profile.getProfileId()}', '${currUser}')|" th:disabled="${profile.isUserFollows()}" th:style="${profile.getProfileId() == currUser ? 'display:none' : 'display:block'}" class="button" id="follow">
                <span th:text="${(profile.isUserFollows()) ? 'Following' : 'Follow'}" id="followStatus">FollowingStatus</span>
            </button>
        </div>
        <div class="header">
            <p>Followers: <span th:text="${profile.getFollowerSize()}" id="followerCount"></span></p>
            <p>Following: <span th:text="${profile.getFollowingSize()}" id="followingCount"></span></p>
            <p>Joined <span th:text="${profile.getJoinDate()}"></span></p>
        </div>
        <h4>Total likes: <span th:text="${profile.getTotalLikes()}"></span></h4>
        <h2>Posts</h2>
        <div class="posts">
            <div class="post-card" th:each="post : ${profile.getPostList()}">
                <div class="post-header">
                    <div>
                        <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M1 12C1 12 0 12 0 11C0 10 1 7 6 7C11 7 12 10 12 11C12 12 11 12 11 12H1Z" fill="black"/>
                            <path d="M6 6C7.65685 6 9 4.65685 9 3C9 1.34315 7.65685 0 6 0C4.34315 0 3 1.34315 3 3C3 4.65685 4.34315 6 6 6Z" fill="black"/>
                        </svg>
                        <a th:href="@{/profile/{profileId}(profileId=${post.getAuthor().getId()})}"><h4 th:text="${post.getAuthor().getName()}" style="margin: 0">Author name</h4></a>
                    </div>
                    <small th:text="${post.getPostDate()}">Post Date</small>
                </div>
                <div class="exercises">
                    <div class="exercise" th:each="exercise : ${post.getTemporalExerciseList()}">
                        <p th:text="${exercise.getName()}"></p>
                        <p>Time: <span th:text="${exercise.getTime()}"></span></p>
                        <small class="body-part" th:each="bodyPart : ${exercise.getBodyParts()}" th:text="${bodyPart}"></small>
                    </div>
                    <div class="exercise" th:each="exercise : ${post.getRepetitiveExerciseList()}">
                        <p th:text="${exercise.getName()}"></p>
                        <p>Repetitions: <span th:text="${exercise.getReps()}"></span> Sets: <span th:text="${exercise.getSets()}"></span></p>
                        <small class="body-part" th:each="bodyPart : ${exercise.getBodyParts()}" th:text="${bodyPart}"></small>
                    </div>
                </div>
                <div class="post-body">
                    <button th:attr="onclick=|upvotePost(this, '${post.getPostId()}', '${currUser}', '${post.getLikes()}')|" th:text="${post.isUserLiked() ? 'Liked' : 'Like'}" th:disabled="${post.isUserLiked()}" class="button"></button>
                    <p> Likes <span th:text="${post.getLikes()}">Post Likes</span></p>
                    <p th:text="${post.getDescription()}"></p>
                </div>
            </div>
        </div>
        <h2>Liked Posts</h2>
        <div class="posts">
            <div class="post-card" th:each="post : ${profile.getLikedPostList()}">
                <div class="post-header">
                    <div>
                        <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M1 12C1 12 0 12 0 11C0 10 1 7 6 7C11 7 12 10 12 11C12 12 11 12 11 12H1Z" fill="black"/>
                            <path d="M6 6C7.65685 6 9 4.65685 9 3C9 1.34315 7.65685 0 6 0C4.34315 0 3 1.34315 3 3C3 4.65685 4.34315 6 6 6Z" fill="black"/>
                        </svg>
                        <a th:href="@{/profile/{profileId}(profileId=${post.getAuthor().getId()})}"><h4 th:text="${post.getAuthor().getName()}" style="margin: 0">Author name</h4></a>
                    </div>
                    <small th:text="${post.getPostDate()}">Post Date</small>
                </div>
                <div class="exercises">
                    <div class="exercise" th:each="exercise : ${post.getTemporalExerciseList()}">
                        <p th:text="${exercise.getName()}"></p>
                        <p>Time: <span th:text="${exercise.getTime()}"></span></p>
                        <small class="body-part" th:each="bodyPart : ${exercise.getBodyParts()}" th:text="${bodyPart}"></small>
                    </div>
                    <div class="exercise" th:each="exercise : ${post.getRepetitiveExerciseList()}">
                        <p th:text="${exercise.getName()}"></p>
                        <p>Repetitions: <span th:text="${exercise.getReps()}"></span> Sets: <span th:text="${exercise.getSets()}"></span></p>
                        <small class="body-part" th:each="bodyPart : ${exercise.getBodyParts()}" th:text="${bodyPart}"></small>
                    </div>
                </div>
                <div class="post-body">
                    <button th:attr="onclick=|upvotePost(this, '${post.getPostId()}', '${currUser}', '${post.getLikes()}')|" th:text="${post.isUserLiked() ? 'Liked' : 'Like'}" th:disabled="${post.isUserLiked()}" class="button"></button>
                    <p> Likes <span th:text="${post.getLikes()}">Post Likes</span></p>
                    <p th:text="${post.getDescription()}"></p>
                </div>
            </div>
        </div>
    </div>
</body>
<script th:inline="javascript">
    const followerCount = document.getElementById("followerCount");
    const followStatus = document.getElementById("followStatus")
    const followButton = document.getElementById("follow");
    let followers = [[${profile.getFollowerSize()}]]

    const followUser = async (e, followeeId, followerId) => {
        const response = await fetch("/follow/", {
            method: "POST",
            mode: "cors",
            cache: "no-cache",
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                followeeId: followeeId,
                followerId: followerId})
        })

        followers += 1;
        followStatus.textContent = "Following"
        followButton.disabled = true;
        followerCount.textContent = followers;
    }

    const upvotePost = async (e, postId, userId, postLikes) => {
        const response = await fetch("/upvote/",  {
            method: "POST",
            mode: "cors",
            cache: "no-cache",
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                postId: postId,
                userId: userId})
        })

        e.nextElementSibling.querySelector("span").textContent = parseInt(postLikes) + 1;
        e.textContent = "Liked";
        e.disabled = true;
    }
</script>
</html>